(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[248],{5966:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/noon",function(){return r(3824)}])},3824:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return Kr}});var t=r(5893),o=r(7294),i=r(9473),a=r(1325),u=r(4034),s=r(4051),l=r.n(s),c=r(9402),d=r(4949),f=r(8697);function v(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function p(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},t=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),t.forEach((function(n){v(e,n,r[n])}))}return e}var m=0,y=(0,d.oM)({name:"users",initialState:{user:{}},reducers:{userAdded:function(e,n){e.push({id:++m,name:n.payload.name,bugsAssigned:[]})},assignBugToUser:function(e,n){var r=n.payload,t=r.bugId,o=r.userId,i=e.findIndex((function(e){return e.id===o}));e[i].bugsAssigned.push(t)},setLoggedInUser:function(e,n){var r;(null===(r=n.payload.user)||void 0===r?void 0:r.me)&&(e.user=n.payload.user.me)},addFriendRequestEntry:function(e,n){p({},e.user).friendshipRequests.push(n.payload.friendRequest)},removeFriendRequestEntry:function(e,n){var r;r=n.payload.friendRequests.filter((function(e){return e.uuid!=n.payload.profileUuid})),console.log("friend request entries:",r),e.user.friendshipRequests=r},addFriendEntry:function(e,n){try{var r=p({},e.user);console.log("add friend entry:",n.payload.friend),r.friends.push(n.payload.friend)}catch(t){console.log("error:",t)}},removeFriendEntry:function(e,n){var r;r=n.payload.friends.filter((function(e){return e.uuid!=n.payload.profileUuid})),e.user.friends=r}}}),h=(0,f.P1)((function(e){return e.entities.users}),(function(e){return e})),g=y.actions,x=(g.userAdded,g.assignBugToUser,g.setLoggedInUser),b=g.addFriendRequestEntry,j=g.removeFriendRequestEntry,w=g.addFriendEntry,U=g.removeFriendEntry,S=(y.reducer,r(1475)),C=r(6617),k=r(3924),P=r(4096),I=r(336),A=r(9782),O=r(8420),N=r(7497),M=(0,d.oM)({name:"sockets",initialState:{socket:null},reducers:{setSocket:function(e,n){e.socket=n.payload.socket}}}),F=(0,f.P1)((function(e){return e.entities.sockets}),(function(e){return e.socket})),q=M.actions.setSocket,E=(M.reducer,r(6281));function R(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function T(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function H(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},t=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),t.forEach((function(n){T(e,n,r[n])}))}return e}function D(e){return function(e){if(Array.isArray(e))return R(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"===typeof e)return R(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return R(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var z=(0,d.oM)({name:"chat",initialState:{conversations:null,activeConversee:null,activeConversation:null,conversationsThatHaveUnreadMessagesForProfile:[],activeConversationSet:!1,shouldPauseCheckHasMore:!1},reducers:{setActiveConversationSet:function(e,n){e.activeConversationSet=n.payload},addConversation:function(e,n){var r,t=H({},n.payload.conversation);(console.log("conversation object:",t),"group"!==t.type)&&(t.conversee=null===(r=t.profiles)||void 0===r?void 0:r.find((function(e){return e.uuid!=n.payload.loggedInProfileUuid})));e.conversations.push(t)},removeConversation:function(e,n){e.conversations=e.conversations.filter((function(e){return e.uuid!=n.payload.conversationUuid}))},removeParticipantFromGroup:function(e,n){var r=e.conversations.find((function(e){return e.uuid===n.payload.conversationUuid})),t=D(r.profiles);if(t.splice(t.indexOf(n.payload.participantUuid),1),r.profiles=t,e.activeConversation&&e.activeConversation.uuid===n.payload.conversationUuid){var o=D(e.activeConversation.profiles);o=o.filter((function(e){return e.uuid!=n.payload.participantUuid})),e.activeConversation.profiles=o}},setConversations:function(e,n){var r=[];Promise.all(n.payload.conversationsToSend.map((function(t){var o,i=H({},t),a=i.profiles.find((function(e){return e.uuid!=n.payload.loggedInProfileUuid})),u=null===(o=i.calls)||void 0===o?void 0:o.find((function(e){return e.profileUuid===n.payload.loggedInProfileUuid}));0!==t.unreadMessages&&t.profileThatHasUnreadMessages===n.payload.loggedInProfileUuid&&e.conversationsThatHaveUnreadMessagesForProfile.push(t.uuid),i.pendingCall=u.pendingCall,i.ongoingCall=u.ongoingCall,i.conversee=a,r.push(i)}))),e.conversations=r},addMessagesToConversation:function(e,n){var r,t,o=n.payload.conversationUuid,i=n.payload.messages,a=null===(r=n.payload.loggedInUser.user)||void 0===r||null===(t=r.profile)||void 0===t?void 0:t.uuid;if(e.activeConversation&&e.activeConversation.uuid===o){var u=D(e.activeConversation.messages);Promise.all(i.map((function(e){e=e.sender.uuid===a?H({},e,{from:"me"}):H({},e,{from:"other"}),u.push(e)})));var s=u.sort((function(e,n){return n.createdAt-e.createdAt}));console.log("sorted messages:",s),e.activeConversation.messages=s}},addMessageToActiveConversation:function(e,n){var r=n.payload.conversationUuid;if(console.log("chat active converastion:",e.activeConversation),console.log("payload.conversationUuid:",n.payload.conversationUuid),console.log("action.payload:",n.payload),e.activeConversation&&e.activeConversation.uuid===r){var t,o,i,a;e.activeConversation.messages.unshift({uuid:n.payload.uuid,content:n.payload.message,updatedAt:(new Date).getTime(),createdAt:(new Date).getTime(),from:n.payload.from,type:n.payload.type,src:n.payload.src,deleted:n.payload.deleted,sender:{uuid:null===(t=n.payload.sender)||void 0===t?void 0:t.uuid,username:null===(o=n.payload.sender)||void 0===o?void 0:o.username}}),e.conversations.find((function(e){return e.uuid===r})).messages.unshift({uuid:n.payload.uuid,content:n.payload.message,updatedAt:(new Date).getTime(),createdAt:(new Date).getTime(),type:n.payload.type,src:n.payload.src,deleted:n.payload.deleted,sender:{uuid:null===(i=n.payload.sender)||void 0===i?void 0:i.uuid,username:null===(a=n.payload.sender)||void 0===a?void 0:a.username}})}else{var u,s,l=e.conversations.find((function(e){return e.uuid===r}));l.unreadMessages=l.unreadMessages+1,l.profileThatHasUnreadMessages=n.payload.loggedInProfile.uuid,void 0==e.conversationsThatHaveUnreadMessagesForProfile[r]&&e.conversationsThatHaveUnreadMessagesForProfile.push(r),l.messages.unshift({uuid:n.payload.uuid,content:n.payload.message,updatedAt:(new Date).getTime(),createdAt:(new Date).getTime(),from:n.payload.from,type:n.payload.type,src:n.payload.src,deleted:n.payload.deleted,sender:{uuid:null===(u=n.payload.sender)||void 0===u?void 0:u.uuid,username:null===(s=n.payload.sender)||void 0===s?void 0:s.username}})}},addMessageToConversationByConversationUuid:function(e,n){var r=n.payload.conversationUuid;n.payload.message;e.conversations.find((function(e){return e.uuid===r})).messages.push({uuid:(0,E.Vj)(),content:n.payload.message,updatedAt:new Date,createdAt:new Date,from:n.payload.from,sender:{uuid:n.payload.loggedInUser.uuid,username:n.payload.loggedInUser.username}})},setActiveConversee:function(e,n){e.activeConversee=n.payload},clearUnreadMessagesForConversationInStore:function(e,n){var r=e.activeConversation;r.unreadMessages=0,r.profileThatHasUnreadMessages=[]},setActiveConversationHasMoreMessages:function(e,n){e.activeConversation.hasMore=n.payload},setShouldPauseCheckHasMore:function(e,n){e.shouldPauseCheckHasMore=n.payload},setActiveConversation:function(e,n){if(null!==n.payload){var r=e.conversationsThatHaveUnreadMessagesForProfile.indexOf(n.payload.conversation.uuid);r>-1&&e.conversationsThatHaveUnreadMessagesForProfile.splice(r,1);var t=H({},n.payload.conversation),o=e.conversations.find((function(e){return e.uuid===t.uuid})),i=o.calls.find((function(e){return e.profileUuid===n.payload.loggedInProfileUuid}));if(t.pendingCall=i.pendingCall,o.unreadMessages=0,o.profileThatHasUnreadMessages=[],o.ongoingCall=!1,n.payload.conversation.messages){var a=[];n.payload.conversation.messages.map((function(e){var r=H({},e);r.from=r.sender.uuid==n.payload.loggedInProfileUuid?"me":"computer",a.push(r)}));var u=a.sort((function(e,n){return n.createdAt-e.createdAt}));t.messages=D(u)}else t.messages=[];e.activeConversation||(e.activeConversation=null),e.activeConversation=t}else e.activeConversation=null},setOngoingCall:function(e,n){var r=H({},e.activeConversation);r.ongoingCall=n.payload,e.activeConversation=H({},r)},setActiveGroupInStore:function(e,n){if(null!==n.payload){var r=H({},n.payload.conversation),t=e.conversations.find((function(e){return e.uuid===r.uuid}));if(t.unreadMessages=0,t.profileThatHasUnreadMessages=[],t.ongoingCall=!1,n.payload.conversation.messages){var o=[];n.payload.conversation.messages.map((function(e){var r=H({},e);r.from=r.sender.uuid==n.payload.loggedInProfileUuid?"me":"computer",o.push(r)}));var i=o.sort((function(e,n){return n.createdAt-e.createdAt}));r.messages=D(i)}else r.messages=[];e.activeConversation||(e.activeConversation=null),e.activeConversation=r}else e.activeConversation=null},setPendingCall:function(e,n){try{var r;if(e.activeConversation&&e.activeConversation.uuid===(null===(r=n.payload)||void 0===r?void 0:r.conversationUuid)&&n.payload.profileUuid!==n.payload.from){var t=H({},e.activeConversation);t.pendingCall=n.payload.pendingCall,t.calls.find((function(e){return e.profileUuid===n.payload.profileUuid})).pendingCall=n.payload.pendingCall,e.activeConversation=H({},t)}var o=e.conversations.find((function(e){var r;return e.uuid===(null===(r=n.payload)||void 0===r?void 0:r.conversationUuid)})),i=o.calls.find((function(e){return e.profileUuid===n.payload.profileUuid}));n.payload.fromJoin||(i.pendingCall=n.payload.pendingCall),o.pendingCall=n.payload.pendingCall}catch(a){console.log("error:",a)}},cancelPendingCall:function(e,n){if(e.activeConversation){var r=H({},e.activeConversation);r.calls.find((function(e){return e.profileUuid===n.payload.loggedInProfileUuid})).pendingCall=!1,r.pendingCall=!1,r.pendingCallProfile=null,e.activeConversation=H({},r)}var t=e.conversations.find((function(e){return e.uuid===n.payload.conversationUuid}));t.calls.find((function(e){return e.profileUuid===n.payload.loggedInProfileUuid})).pendingCall=!1,t.pendingCall=!1,t.pendingCallProfile=null},deleteMessageInStore:function(e,n){console.log("message in update message:",n.payload);try{var r=e.conversations.find((function(e){return e.uuid===n.payload.conversationUuid})).messages.find((function(e){return e.uuid===n.payload.uuid}));if(console.log("message in update message:",n.payload.message),r.deleted=n.payload.deleted,r.content=n.payload.content,e.activeConversation){var t=e.activeConversation.messages.find((function(e){return e.uuid===n.payload.uuid}));t.deleted=n.payload.deleted,t.content=n.payload.content}}catch(o){console.log("error:",o)}}}}),W=(0,f.P1)((function(e){return e.entities.chat}),(function(e){return e.conversations})),L=(0,f.P1)((function(e){return e.entities.chat}),(function(e){return e.conversations})),G=(0,f.P1)((function(e){return e.entities.chat}),(function(e){return e.activeConversee})),_=(0,f.P1)((function(e){return e.entities.chat}),(function(e){return e.activeConversation})),B=(0,f.P1)((function(e){return e.entities.chat}),(function(e){return e.activeConversationSet})),J=(0,f.P1)((function(e){return e.entities.chat}),(function(e){return e.shouldPauseCheckHasMore})),$=((0,f.P1)((function(e){return e.entities.chat}),(function(e){return e.conversationsThatHaveUnreadMessagesForProfile})),z.actions),X=$.addConversation,V=$.removeConversation,Z=$.setConversations,K=$.setActiveConversee,Q=$.setActiveConversation,Y=$.addMessageToActiveConversation,ee=$.addMessagesToConversation,ne=($.addMessageToConversationByConversationUuid,$.clearUnreadMessagesForConversationInStore),re=$.setActiveConversationSet,te=$.setOngoingCall,oe=$.setPendingCall,ie=$.cancelPendingCall,ae=$.setActiveConversationHasMoreMessages,ue=$.setShouldPauseCheckHasMore,se=$.setActiveGroupInStore,le=$.removeParticipantFromGroup,ce=$.deleteMessageInStore,de=(z.reducer,r(9367)),fe=r(8017),ve=(0,de.ZP)("http://localhost:4020",{autoConnect:!1});function pe(){var e=(0,i.I0)(),n=(0,i.v9)(h),r=(0,o.useState)(ve.connected),a=r[0],u=r[1],s=(0,o.useState)(!1),l=s[0],c=s[1];return(0,o.useEffect)((function(){var r=localStorage.getItem("sessionID");console.log("session id:",r);try{var t,o,i,a,s,d,f,v,p,m,y,h,g,x;if(r&&(null===(t=n.user)||void 0===t||null===(o=t.profile)||void 0===o?void 0:o.uuid))console.log("sessionID:",r),ve.auth={sessionID:r,username:null===n||void 0===n||null===(i=n.user)||void 0===i||null===(a=i.profile)||void 0===a?void 0:a.username,userSocketUuid:null===(s=n.user)||void 0===s||null===(d=s.profile)||void 0===d?void 0:d.uuid,userID:null===(f=n.user)||void 0===f||null===(v=f.profile)||void 0===v?void 0:v.uuid},ve.connect(),e(q({socket:ve}));else ve.auth={username:null===n||void 0===n||null===(p=n.user)||void 0===p||null===(m=p.profile)||void 0===m?void 0:m.username,userSocketUuid:null===(y=n.user)||void 0===y||null===(h=y.profile)||void 0===h?void 0:h.uuid,userID:null===(g=n.user)||void 0===g||null===(x=g.profile)||void 0===x?void 0:x.uuid},ve.connect(),e(q({socket:ve}))}catch(b){c(!0),console.log("socket error:",l)}return ve.on("session",(function(e){var n=e.sessionID,r=e.userID;console.log("session received:",n),ve.auth={sessionID:n},localStorage.setItem("sessionID",n),ve.userID=r})),ve.on("disconnect",(function(){u(!1)})),ve.on("connect_error",(function(e){"invalid username"===e.message&&u(!1)})),ve.on("connect",(function(){u(!0)})),ve.onAny((function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),t=1;t<n;t++)r[t-1]=arguments[t];console.log(e,r)})),function(){ve.off("connect"),ve.off("disconnect"),ve.off("session"),ve.off("connect_error")}}),[n]),(0,t.jsx)(fe.xu,{className:"flex mt-0.5",children:a?(0,t.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded ml-2 "}):(0,t.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded ml-2 "})})}var me=r(1163),ye=(0,d.oM)({name:"ui",initialState:{chatComponent:"closed",createGroupComponentOpen:!1,chatContainerHeight:"87.5vh",search:{searchActive:!1,containerDisplay:"relative",containerHeight:"5vh",inputPadding:"5px"}},reducers:{setSocket:function(e,n){e.socket=n.payload.socket},showFriendshipRequestToast:function(e,n){},setChatComponentState:function(e,n){e.chatComponent=n.payload},setCreateGroupComponent:function(e,n){e.createGroupComponentOpen=n.payload},setChatContainerHeight:function(e,n){e.chatContainerHeight=n.payload},setSearchComponent:function(e,n){e.search.searchActive=n.payload.searchActive,e.search.containerDisplay=n.payload.containerDisplay,e.search.containerHeight=n.payload.containerHeight,e.search.inputPadding=n.payload.inputPadding}}}),he=((0,f.P1)((function(e){return e.entities.ui}),(function(e){return e.chatComponent})),(0,f.P1)((function(e){return e.entities.ui}),(function(e){return e.createGroupComponentOpen}))),ge=(0,f.P1)((function(e){return e.entities.ui}),(function(e){return e.search})),xe=(0,f.P1)((function(e){return e.entities.ui}),(function(e){return e.chatContainerHeight})),be=ye.actions,je=(be.showFriendshipRequestToast,be.setChatComponentState,be.setCreateGroupComponent),we=be.setSearchComponent,Ue=be.setChatContainerHeight,Se=(ye.reducer,(0,d.oM)({name:"groups",initialState:{videoFrameOpen:!1},reducers:{setVideoFrameForConversation:function(e,n){e.videoFrameOpen=n.payload}}})),Ce=(0,f.P1)((function(e){return e.entities.video}),(function(e){return e.videoFrameOpen})),ke=Se.actions.setVideoFrameForConversation;Se.reducer;function Pe(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function Ie(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function Ae(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);a=!0);}catch(s){u=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return Pe(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Pe(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Oe=function(e){var n,r=e.conversation,a=e.i,u=(0,o.useState)()[1],s=(0,i.I0)(),d=(0,i.v9)(h),f=(0,i.v9)(F),v=(0,i.v9)(_),p=Ae((0,c.kJ)(),2)[1];return(0,t.jsxs)(P.k,{tabindex:"0",className:"items-center justify-between p-3 pl-5 border-b border-b-base-300 border-b-amber-100 hover:border-sky-500 focus:outline-none focus:border-sky-700 focus-within:shadow-lg",style:{transition:"all .25s "},children:[(0,t.jsxs)(P.k,{className:"items-center cursor-pointer flex-1",onClick:function(){!function(e,n){var r,t,o,i;s(we({searchActive:!1,containerDisplay:"relative",containerHeight:"5vh",inputPadding:"5px"})),v?n.uuid!==v.uuid&&(s(re(!1)),s(K(null)),s(Q(null)),s(ue(!1)),s(ke(!1)),s(re(!0)),s(K(e)),s(Q({conversation:n,loggedInProfileUuid:null===d||void 0===d||null===(r=d.user)||void 0===r||null===(t=r.profile)||void 0===t?void 0:t.uuid}))):(s(re(!1)),s(K(null)),s(Q(null)),s(ue(!1)),s(re(!0)),s(K(e)),s(Q({conversation:n,loggedInProfileUuid:null===d||void 0===d||null===(o=d.user)||void 0===o||null===(i=o.profile)||void 0===i?void 0:i.uuid}))),s(Ue("87.5vh"))}(r.conversee,r),u(r.conversee)},children:[(0,t.jsx)(N.qE,{name:r.conversee.username,size:"sm",className:"mr-2",children:r.unreadMessages&&0!==r.unreadMessages&&r.profileThatHasUnreadMessages===d.user.profile.uuid?(0,t.jsx)(N.MX,{boxSize:"1.25em",bg:"red.500",children:(0,t.jsx)("p",{className:"text-xs",children:r.unreadMessages})}):null},a),(0,t.jsx)("p",{children:r.conversee.username})]}),(0,t.jsxs)(A.v2,{children:[(0,t.jsx)(A.j2,{as:O.h,"aria-label":"Options",icon:(0,t.jsx)(S.U,{}),variant:"outline"}),(0,t.jsxs)(A.qy,{children:[(0,t.jsx)(A.sN,{icon:(0,t.jsx)(C.d,{}),onClick:(n=l().mark((function e(){var n,t,o,i,a,u,c,v;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,p({profileUuid:r.conversee.uuid,conversationUuid:r.uuid});case 3:t=e.sent,s(U({profileUuid:r.conversee.uuid,friends:null===(n=d.user)||void 0===n?void 0:n.friends})),s(V({conversationUuid:r.uuid})),s(re(!1)),s(K(null)),s(Q(null)),s(ue(!1)),t&&f.emit("unfriend",{content:(null===(o=d.user)||void 0===o||null===(i=o.profile)||void 0===i?void 0:i.username)+" unfriended you.",from:null===(a=d.user)||void 0===a||null===(u=a.profile)||void 0===u?void 0:u.uuid,fromUsername:null===(c=d.user)||void 0===c||null===(v=c.profile)||void 0===v?void 0:v.username,to:r.conversee.uuid,toUsername:r.conversee.username,conversationUuid:r.uuid});case 11:case"end":return e.stop()}}),e)})),function(){var e=this,r=arguments;return new Promise((function(t,o){var i=n.apply(e,r);function a(e){Ie(i,t,o,a,u,"next",e)}function u(e){Ie(i,t,o,a,u,"throw",e)}a(void 0)}))}),children:"Unfriend"}),(0,t.jsx)(A.sN,{icon:(0,t.jsx)(C.d,{}),children:"Block"})]})]})]},r.uuid)};function Ne(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function Me(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function Fe(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);a=!0);}catch(s){u=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return Ne(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ne(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var qe=function(e){var n,r=e.conversation,o=e.i,a=(0,i.I0)(),u=Fe((0,c.nm)(),2)[1],s=(0,i.v9)(h),d=(0,i.v9)(F),f=(0,i.v9)(_);return(0,t.jsxs)(P.k,{tabindex:"0",className:"items-center justify-between p-3 pl-5 border-b border-b-base-300 border-b-amber-100 hover:border-sky-500 focus:outline-none focus:border-sky-700 focus-within:shadow-lg",style:{transition:"all .25s "},children:[(0,t.jsxs)(P.k,{className:"items-center cursor-pointer flex-1",onClick:function(){!function(e){var n,r;a(re(!1)),a(K(null)),a(Q(null)),a(ue(!1)),a(se(null)),a(we({searchActive:!1,containerDisplay:"relative",containerHeight:"5vh",inputPadding:"5px"})),a(Ue("87.5vh")),a(se({conversation:e,loggedInProfileUuid:null===s||void 0===s||null===(n=s.user)||void 0===n||null===(r=n.profile)||void 0===r?void 0:r.uuid}))}(r)},children:[(0,t.jsx)(N.qE,{name:r.name,size:"sm",className:"mr-2",children:r.unreadMessages&&0!==r.unreadMessages&&r.profileThatHasUnreadMessages===s.user.profile.uuid?(0,t.jsx)(N.MX,{boxSize:"1.25em",bg:"red.500",children:(0,t.jsx)("p",{className:"text-xs",children:r.unreadMessages})}):null},o),(0,t.jsx)("p",{children:r.name})]}),(0,t.jsxs)(A.v2,{children:[(0,t.jsx)(A.j2,{as:O.h,"aria-label":"Options",icon:(0,t.jsx)(S.U,{}),variant:"outline"}),(0,t.jsx)(A.qy,{children:(0,t.jsx)(A.sN,{icon:(0,t.jsx)(C.d,{}),onClick:(n=l().mark((function e(){var n,t,o,i,c,v;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u({groupUuid:r.uuid});case 2:n=e.sent,console.log("leave group response:",n),a(V({conversationUuid:r.uuid})),f&&f.uuid===r.uuid&&(a(re(!1)),a(K(null)),a(Q(null)),a(ue(!1))),n&&(v=[],r.profiles.map((function(e){var n,r;e.uuid!==(null===(n=s.user)||void 0===n||null===(r=n.profile)||void 0===r?void 0:r.uuid)&&v.push(e.uuid)})),d.emit("left-group",{fromUuid:null===(t=s.user)||void 0===t||null===(o=t.profile)||void 0===o?void 0:o.uuid,fromUsername:null===(i=s.user)||void 0===i||null===(c=i.profile)||void 0===c?void 0:c.username,conversationUuid:r.uuid,participants:v}));case 7:case"end":return e.stop()}}),e)})),function(){var e=this,r=arguments;return new Promise((function(t,o){var i=n.apply(e,r);function a(e){Me(i,t,o,a,u,"next",e)}function u(e){Me(i,t,o,a,u,"throw",e)}a(void 0)}))}),children:"Leave group"})})]})]},r.uuid)};function Ee(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function Re(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function Te(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function a(e){Re(i,t,o,a,u,"next",e)}function u(e){Re(i,t,o,a,u,"throw",e)}a(void 0)}))}}function He(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);a=!0);}catch(s){u=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,n)||ze(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function De(e){return function(e){if(Array.isArray(e))return Ee(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ze(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ze(e,n){if(e){if("string"===typeof e)return Ee(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ee(e,n):void 0}}var We=function(){var e,n,r=(0,me.useRouter)(),o=(0,i.I0)(),a=He((0,c._y)(),2)[1],u=(0,i.v9)(h),s=(0,i.v9)(L);return(0,t.jsxs)("div",{className:"flex flex-col bg-neutral text-white box-content scroll-auto",style:{flex:"0.25",height:"100vh"},children:[(0,t.jsxs)(P.k,{className:"items-center justify-between border-b",style:{flex:"0.05"},children:[(0,t.jsx)(I.X,{className:"w-full px-4",children:"Noon"}),(0,t.jsxs)(A.v2,{children:[(0,t.jsx)(A.j2,{as:O.h,"aria-label":"Options",icon:(0,t.jsx)(S.U,{}),variant:"outline",className:"mr-3"}),(0,t.jsx)(A.qy,{children:(0,t.jsx)(A.sN,{icon:(0,t.jsx)(C.d,{}),onClick:Te(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(re(!1)),o(K(null)),o(Q(null)),o(ue(!1)),o(je(!0)),o(we({searchActive:!1,containerDisplay:"relative",containerHeight:"5vh",inputPadding:"5px"}));case 6:case"end":return e.stop()}}),e)}))),children:"Create group"})})]})]}),(0,t.jsx)(P.k,{className:"flex-col pt-3 scroll-auto overflow-auto",style:{flex:"0.875"},children:s?De(Object.values(s)).map((function(e,n){return e?"pm"===e.type?(0,t.jsx)(Oe,{conversation:e,i:n}):(0,t.jsx)(qe,{conversation:e,i:n}):null})):null}),(0,t.jsxs)(P.k,{className:"flex justify-between items-center border-t box-content",style:{flex:"0.075"},children:[(0,t.jsxs)(P.k,{className:"items-center px-2 ",children:[(0,t.jsx)(N.qE,{size:"md"}),(0,t.jsx)("p",{className:"ml-2 text-md",children:null===(e=u.user)||void 0===e||null===(n=e.profile)||void 0===n?void 0:n.username}),(0,t.jsx)(pe,{})]}),(0,t.jsx)(P.k,{className:"px-3 justify-between",children:(0,t.jsxs)(A.v2,{children:[(0,t.jsx)(A.j2,{children:(0,t.jsx)(k.e,{})}),(0,t.jsx)(A.qy,{children:(0,t.jsx)(A.sN,{onClick:Te(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a();case 2:return e.next=4,r.push("/");case 4:case"end":return e.stop()}}),e)}))),children:"Logout"})})]})})]})]})},Le=r(7786),Ge=r(980),_e=r(9887),Be=r(8530),Je=r(5680);var $e=r(58),Xe=r(3990);function Ve(e){var n,r,o=e.recorderState,i=e.handlers,a=o.recordingMinutes,u=o.recordingSeconds,s=o.initRecording,l=i.startRecording,c=i.saveRecording,d=i.cancelRecording;return(0,t.jsxs)(P.k,{className:"items-center mx-2 bg-blue-300 rounded px-2 relative z-20",children:[(0,t.jsx)(P.k,{className:"items-center py-0",children:s&&(0,t.jsxs)(P.k,{className:"",children:[(0,t.jsx)(P.k,{className:"",children:(0,t.jsx)("button",{className:"mb-1 p-2 cursor-pointer hover:text-red-500",title:"Cancel recording",onClick:d,children:(0,t.jsx)($e.J,{as:Xe.ZCS})})}),(0,t.jsxs)(P.k,{className:"mx-2 items-center text-lg bg-green-300 rounded p-1 px-2",children:[s&&(0,t.jsx)("div",{className:"recording-indicator"}),(0,t.jsx)("span",{children:(r=a,r<10?"0".concat(r):"".concat(r))}),(0,t.jsx)("span",{children:":"}),(0,t.jsx)("span",{children:(n=u,n<10?"0".concat(n):"".concat(n))})]})]})}),(0,t.jsx)(P.k,{className:"items-center",children:s?(0,t.jsx)("button",{className:"mb-1 text-green-600",title:"Save recording",disabled:0===u,onClick:c,children:(0,t.jsx)($e.J,{as:Xe.W3E})}):(0,t.jsx)("button",{className:"mb-1 mx-2",title:"Start recording",onClick:l,children:(0,t.jsx)($e.J,{as:Xe.Lsc})})})]})}function Ze(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function Ke(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function a(e){Ze(i,t,o,a,u,"next",e)}function u(e){Ze(i,t,o,a,u,"throw",e)}a(void 0)}))}}function Qe(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function Ye(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},t=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),t.forEach((function(n){Qe(e,n,r[n])}))}return e}function en(){return(en=Ke(l().mark((function e(n){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0});case 3:r=e.sent,n((function(e){return Ye({},e,{initRecording:!0,mediaStream:r})})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}var nn=r(6230),rn=r.n(nn),tn=r(9669),on=r.n(tn);function an(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function un(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function a(e){an(i,t,o,a,u,"next",e)}function u(e){an(i,t,o,a,u,"throw",e)}a(void 0)}))}}function sn(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function ln(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},t=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),t.forEach((function(n){sn(e,n,r[n])}))}return e}var cn={recordingMinutes:0,recordingSeconds:0,initRecording:!1,mediaStream:null,mediaRecorder:null,audio:null};function dn(){var e=(0,o.useState)(cn),n=e[0],r=e[1],t=(0,i.I0)(),a=(0,i.v9)(F),u=(0,i.v9)(_),s=(0,i.v9)(h),c=(0,i.v9)(G);return(0,o.useEffect)((function(){var e=null;return n.initRecording?e=setInterval((function(){r((function(n){return 5===n.recordingMinutes&&0===n.recordingSeconds?("number"===typeof e&&clearInterval(e),n):n.recordingSeconds>=0&&n.recordingSeconds<59?ln({},n,{recordingSeconds:n.recordingSeconds+1}):59===n.recordingSeconds?ln({},n,{recordingMinutes:n.recordingMinutes+1,recordingSeconds:0}):n}))}),1e3):"number"===typeof e&&clearInterval(e),function(){"number"===typeof e&&clearInterval(e)}})),(0,o.useEffect)((function(){r((function(e){return e.mediaStream?ln({},e,{mediaRecorder:new MediaRecorder(e.mediaStream)}):e}))}),[n.mediaStream]),(0,o.useEffect)((function(){var e=n.mediaRecorder,o=[];return e&&"inactive"===e.state&&(e.start(),e.ondataavailable=function(e){o.push(e.data)},e.onstop=un(l().mark((function n(){var i,d,f,v;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(f=new Blob(o,{type:"audio/ogg; codecs=opus"}),o=[],(v=new(rn())).append("file",f,"file"),v.append("conversationUuid",u.uuid),v.append("senderUuid",null===(i=s.user)||void 0===i||null===(d=i.profile)||void 0===d?void 0:d.uuid),!e.stream.active){n.next=10;break}return n.next=10,on().post("http://localhost:4020/media_api/upload_audio_recording",v,{headers:{accept:"application/json","Accept-Language":"en-US,en;q=0.8","Content-Type":"multipart/form-data;"}}).then(function(){var e=un(l().mark((function e(n){var r,o,i,d,f,v,p,m,y,h;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"pm"===u.type?a.emit("private-chat-message",{content:(null===(f=s.user)||void 0===f||null===(v=f.profile)||void 0===v?void 0:v.username)+" sent you a message.",from:null===(p=s.user)||void 0===p||null===(m=p.profile)||void 0===m?void 0:m.uuid,fromUsername:null===(y=s.user)||void 0===y||null===(h=y.profile)||void 0===h?void 0:h.username,to:c.uuid,toUsername:c.username,messageUuid:n.data.content,message:n.data.content,type:n.data.type,src:n.data.src,conversationUuid:u.uuid}):u.profiles.map((function(e){var r,t,o,i,l,c,d,f;e.uuid!==(null===(r=s.user)||void 0===r||null===(t=r.profile)||void 0===t?void 0:t.uuid)&&a.emit("private-chat-message",{content:(null===(o=s.user)||void 0===o||null===(i=o.profile)||void 0===i?void 0:i.username)+" sent you a message.",from:null===(l=s.user)||void 0===l||null===(c=l.profile)||void 0===c?void 0:c.uuid,fromUsername:null===(d=s.user)||void 0===d||null===(f=d.profile)||void 0===f?void 0:f.username,to:e.uuid,toUsername:e.username,messageUuid:n.data.uuid,message:n.data.content,type:n.data.type,src:n.data.src,conversationUuid:u.uuid})})),t(Y({uuid:n.data.uuid,message:n.data.content,sender:{uuid:null===s||void 0===s||null===(r=s.user)||void 0===r||null===(o=r.profile)||void 0===o?void 0:o.uuid,username:null===s||void 0===s||null===(i=s.user)||void 0===i||null===(d=i.profile)||void 0===d?void 0:d.username},from:"me",type:n.data.type,src:n.data.src,deleted:!1,conversationUuid:u.uuid}));case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("error on record:",e)})).finally();case 10:r((function(e){return e.mediaRecorder?ln({},cn,{audio:window.URL.createObjectURL(f)}):cn}));case 11:case"end":return n.stop()}}),n)})))),function(){console.log("recorder on exit:",e),e&&e.stream.getAudioTracks().forEach((function(e){return e.stop()}))}}),[n.mediaRecorder]),{recorderState:n,startRecording:function(){return function(e){return en.apply(this,arguments)}(r)},cancelRecording:function(){return r(cn)},saveRecording:function(){var e;"inactive"!==(e=n.mediaRecorder).state&&(console.log("recorder state:",JSON.stringify(e)),e.stop())}}}function fn(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function vn(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function pn(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function a(e){vn(i,t,o,a,u,"next",e)}function u(e){vn(i,t,o,a,u,"throw",e)}a(void 0)}))}}function mn(e,n){if(null==e)return{};var r,t,o=function(e,n){if(null==e)return{};var r,t,o={},i=Object.keys(e);for(t=0;t<i.length;t++)r=i[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)r=i[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function yn(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);a=!0);}catch(s){u=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return fn(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fn(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var hn=function(e){var n=e.inputMessage,r=e.setInputMessage,a=e.handleSendMessage,u=(0,i.I0)(),s=(0,i.v9)(F),d=(0,i.v9)(_),f=(0,i.v9)(h),v=(0,i.v9)(G),p=yn((0,c.xD)(),2)[1],m=dn(),y=m.recorderState,g=mn(m,["recorderState"]);return(0,o.useEffect)((function(){return s&&(s.on("set-ongoing-call-for-conversation",(function(e){var n=e.from,r=e.fromUsername;u(te({uuid:d.uuid,initiator:{uuid:n,username:r}}))})),s.on("message-deleted",(function(e){var n=e.messageUuid,r=e.conversationUuid;u(ce({uuid:n,content:"Message has been deleted.",deleted:!0,conversationUuid:r}))}))),function(){s&&s.off("set-ongoing-call-for-conversation")}}),[v]),(0,t.jsxs)(P.k,{className:"bg-white items-center box-content h-full justify-between",children:[(0,t.jsx)(fe.xu,{className:"w-4/6 relative z-10",children:(0,t.jsx)(_e.I,{className:"py-2 box-content text-black",placeholder:"Type message...",border:"none",borderRadius:"none",outline:0,onKeyPress:function(e){"Enter"===e.key&&a()},value:n,onChange:function(e){return r(e.target.value)}})}),(0,t.jsxs)(P.k,{className:"w-2/6 justify-end",children:[(0,t.jsx)(Ve,{recorderState:y,handlers:g}),(0,t.jsx)(Be.z,{className:"mr-2",bg:"green.500",title:"Start call",_hover:{bg:"black",color:"black",border:"1px solid black"},onClick:pn(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u(ke(!0)),d.profiles.map(function(){var e=pn(l().mark((function e(n){var r,t,o,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.emit("set-pending-call-for-conversation",{from:null===(r=f.user)||void 0===r||null===(t=r.profile)||void 0===t?void 0:t.uuid,fromUsername:null===(o=f.user)||void 0===o||null===(i=o.profile)||void 0===i?void 0:i.username,to:n.uuid,toUsername:n.username,conversationUuid:d.uuid}),e.next=4,p({conversationUuid:d.uuid,profileUuid:n.uuid});case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),children:(0,t.jsx)(Je.q,{className:"",color:"white"})}),(0,t.jsx)(Be.z,{bg:"black",color:"white",title:"Send message",className:"mr-3",_hover:{bg:"white",color:"black",border:"1px solid black"},disabled:n.trim().length<=0,onClick:a,children:"Send"})]})]})},gn=r(4115);function xn(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function bn(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function jn(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function a(e){bn(i,t,o,a,u,"next",e)}function u(e){bn(i,t,o,a,u,"throw",e)}a(void 0)}))}}function wn(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);a=!0);}catch(s){u=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return xn(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xn(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Un=function(){var e=(0,i.v9)(G),n=(0,i.I0)(),r=(0,i.v9)(h),a=(0,i.v9)(F),u=(0,o.useState)("loading"),s=u[0],d=u[1],f=(0,i.v9)(_),v=wn((0,c.Fg)(),2)[1];return(0,o.useEffect)((function(){var n,t,o,i;e&&(a.emit("check-friend-connection",{from:null===(n=r.user)||void 0===n||null===(t=n.profile)||void 0===t?void 0:t.uuid,fromUsername:null===(o=r.user)||void 0===o||null===(i=o.profile)||void 0===i?void 0:i.username,to:e.uuid,toUsername:e.username}),a.on("check-friend-connection",(function(e){!0===e.session.connected&&d("true")})),a.on("friend-connected",(function(n){var r=n.uuid;console.log("friend connected:",r),r===e.uuid&&d("true")})),a.on("friend-disconnected",(function(n){n.uuid===e.uuid&&d("false")})));return function(){d("loading"),a.off("check-friend-connection"),a.off("friend-connected"),a.off("friend-disconnected")}}),[e]),(0,t.jsxs)(P.k,{w:"100%",className:"items-center justify-between",children:[(0,t.jsxs)(P.k,{className:"items-center px-3",children:[(0,t.jsx)(N.qE,{size:"md",name:"pm"===f.type?e.username:f.name,children:"pm"===f.type?(0,t.jsx)(N.MX,{boxSize:"1.25em",bg:"true"!==s?"yellow.500":"green.500"}):null}),(0,t.jsxs)(P.k,{flexDirection:"column",mx:"3",my:"5",justify:"center",children:[(0,t.jsx)(gn.x,{fontSize:"lg",fontWeight:"bold",children:"pm"===f.type?e.username:f.name}),"pm"===f.type?(0,t.jsx)(gn.x,{color:"green.500",fontSize:"sm",children:"true"===s?"Online":(0,t.jsx)("span",{className:"opacity-0",children:"f"})}):null]}),"group"===f.type?f.profiles.map((function(e,n){return(0,t.jsxs)(gn.x,{className:"mr-2",children:[e.username,","]},n)})):null]}),(null===f||void 0===f?void 0:f.pendingCall)?(0,t.jsx)(P.k,{className:"h-full py-4 flex-col justify-end items-end w-1/2",children:(0,t.jsxs)(P.k,{className:"flex justify-end px-4 py-2 items-center",bg:"blue.500",children:[(0,t.jsx)(gn.x,{className:"mb-2 mr-3 mt-1 font-black",children:"Call ongoing"}),(0,t.jsx)(Be.z,{bg:"red.500",className:"mr-2",children:(0,t.jsx)(I.X,{fontSize:"md",onClick:jn(l().mark((function e(){var t,o,i,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(ie({conversationUuid:f.uuid,loggedInProfileUuid:null===(t=r.user)||void 0===t||null===(o=t.profile)||void 0===o?void 0:o.uuid})),e.next=4,v({conversationUuid:f.uuid,profileUuid:null===(i=r.user)||void 0===i||null===(u=i.profile)||void 0===u?void 0:u.uuid});case 4:f.calls.map((function(e){var n,t,o,i;a.emit("cancel-pending-call-for-conversation",{from:null===(n=r.user)||void 0===n||null===(t=n.profile)||void 0===t?void 0:t.uuid,fromUsername:null===(o=r.user)||void 0===o||null===(i=o.profile)||void 0===i?void 0:i.username,to:e.profileUuid,toUsername:e.profileUsername,conversationUuid:f.uuid})}));case 5:case"end":return e.stop()}}),e)}))),children:"Cancel"})}),(0,t.jsx)(Be.z,{bg:"green.500",children:(0,t.jsx)(I.X,{fontSize:"md",onClick:jn(l().mark((function e(){var t,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(ke(!0)),n(oe({profileUuid:null===(t=r.user)||void 0===t||null===(o=t.profile)||void 0===o?void 0:o.uuid,from:"fewfewf",fromJoin:!0,pendingCall:!1,ongoingCall:!1,conversationUuid:f.uuid}));case 3:case"end":return e.stop()}}),e)}))),children:"Join"})})]})}):null]})},Sn=r(9266),Cn=r(123),kn=r(6569),Pn=r(1540),In=r.n(Pn),An=r(8533);function On(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function Nn(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function Mn(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function a(e){Nn(i,t,o,a,u,"next",e)}function u(e){Nn(i,t,o,a,u,"throw",e)}a(void 0)}))}}function Fn(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);a=!0);}catch(s){u=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,n)||En(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qn(e){return function(e){if(Array.isArray(e))return On(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||En(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function En(e,n){if(e){if("string"===typeof e)return On(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?On(e,n):void 0}}var Rn=function(){var e=(0,i.I0)(),n=(0,i.v9)(h),r=(0,i.v9)(_),a=(0,i.v9)(G),u=(0,i.v9)(J),s=(0,i.v9)(F),d=Fn((0,c.N3)(),2)[1],f=Fn((0,c.h$)(),2)[1],v=(0,o.useState)({limit:20,cursor:0!==r.messages.length?r.messages[r.messages.length-1].createdAt:null,conversationUuid:r.uuid}),p=v[0],m=v[1],y=(0,o.useState)(!0),g=y[0],x=y[1],b=(0,o.useState)(!1)[1],j=(0,o.useState)([]),w=j[0],U=j[1],S=Fn((0,c.VO)({variables:p,pause:g,requestPolicy:"network-only"}),1)[0].data,C=Fn((0,c.jE)({variables:{conversationUuid:r.uuid},pause:u,requestPolicy:"network-only"}),1)[0].data;(0,o.useEffect)((function(){return console.log("hasmore on init:",null===C||void 0===C?void 0:C.checkIfConversationHasMoreMessages),(null===C||void 0===C?void 0:C.checkIfConversationHasMoreMessages)&&e(ae(null===C||void 0===C?void 0:C.checkIfConversationHasMoreMessages)),function(){b(!1),U([])}}),[null===C||void 0===C?void 0:C.checkIfConversationHasMoreMessages]),(0,o.useEffect)((function(){return S&&(b(!0),e(ue(!0)),C=void 0,U((function(e){return qn(e)}))),function(){b(!1),U([])}}),[S]),(0,o.useEffect)((function(){0!==w.length&&e(ee({conversationUuid:r.uuid,messages:w,loggedInUser:n}))}),[w]),(0,o.useEffect)((function(){return r.unreadMessages&&0!==r.unreadMessages&&r.profileThatHasUnreadMessages===n.user.profile.uuid&&(d({conversationUuid:r.uuid,profileUuid:"fejfnewjnfewjf"}),e(ne)),function(){}}),[]);var k=function(){var t=Mn(l().mark((function t(o){var i,a,u,c;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,f({messageUuid:o.uuid,conversationUuid:r.uuid,from:n.user.profile.uuid,type:o.type,src:o.src});case 3:c=t.sent,console.log("message in update message1:",c),e(ce({uuid:null===(i=c.data)||void 0===i?void 0:i.deleteMessage.uuid,content:null===(a=c.data)||void 0===a?void 0:a.deleteMessage.content,deleted:null===(u=c.data)||void 0===u?void 0:u.deleteMessage.deleted,conversationUuid:r.uuid})),r.profiles.map((function(e){var t,i,a,u;e.uuid!==(null===(t=n.user)||void 0===t||null===(i=t.profile)||void 0===i?void 0:i.uuid)&&s.emit("message-deleted",{messageUuid:o.uuid,to:e.uuid,toUsername:e.username,fromUsername:null===(a=n.user)||void 0===a||null===(u=a.profile)||void 0===u?void 0:u.username,from:n.user.profile.uuid,conversationUuid:r.uuid})}));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,t.jsx)(P.k,{id:"scrollableDiv",overflowY:"auto",flexDirection:"column-reverse",className:"w-full top-0 py-3 px-5 relative",style:{height:"80vh"},children:(0,t.jsx)(An.Z,{dataLength:r.messages,next:function(){setTimeout((function(){m({conversationUuid:r.uuid,limit:p.limit,cursor:r.messages[r.messages.length-1].createdAt}),x(!1)}),750)},style:{display:"flex",flexDirection:"column-reverse"},inverse:!0,hasMore:u?!(null===S||void 0===S?void 0:S.getMessagesForConversation)||!!(null===S||void 0===S?void 0:S.getMessagesForConversation.hasMore):!!(null===C||void 0===C?void 0:C.checkIfConversationHasMoreMessages),loader:(0,t.jsx)("h4",{className:"m-auto text-xl py-5 top-0 left-1/2",children:"Loading..."}),scrollableTarget:"scrollableDiv",children:r&&"pm"===r.type?r.messages.map((function(e,n){return"me"===e.from?(0,t.jsx)(P.k,{w:"100%",justify:"flex-end",children:"text"===e.type?(0,t.jsxs)(P.k,{bg:"black",color:"white",minW:"100px",maxW:"350px",my:"1",pr:e.deleted?"3":"0",pl:"3",py:"2",className:"relative",children:[(0,t.jsx)(gn.x,{className:"",children:e.deleted?(0,t.jsx)("i",{className:"text-gray-400",children:e.content}):e.content}),e.deleted?null:(0,t.jsxs)(A.v2,{children:[(0,t.jsx)(A.j2,{className:"",boxSize:"1rem",as:O.h,"aria-label":"Options",icon:(0,t.jsx)(kn.v,{}),variant:"none",mr:"0",ml:"0",pr:"0",pl:"0",px:0,py:0,mx:0,my:0}),(0,t.jsx)(Sn.h,{children:(0,t.jsx)(A.qy,{children:(0,t.jsx)(A.sN,{className:"text-white",color:"white",onClick:Mn(l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,k(e);case 2:case"end":return n.stop()}}),n)}))),children:"Unsend message"})})})]})]}):"image"===e.type?(0,t.jsxs)(P.k,{className:"justify-end relative",boxSize:e.deleted?"":"sm",bg:e.deleted?"black":"",minW:e.deleted?"":"100px",maxW:e.deleted?"":"350px",my:"1",p:e.deleted?"3":"0",children:[e.deleted?(0,t.jsx)(gn.x,{children:(0,t.jsx)("i",{children:e.content})}):(0,t.jsx)(Cn.E,{src:e.src,alt:e.content}),e.deleted?null:(0,t.jsx)("div",{className:"absolute rounded border-black",children:(0,t.jsxs)(A.v2,{children:[(0,t.jsx)(A.j2,{as:O.h,"aria-label":"Options",icon:(0,t.jsx)(kn.v,{}),variant:"none",px:0,py:0,mx:0,my:0}),(0,t.jsx)(A.qy,{children:(0,t.jsx)(A.sN,{onClick:Mn(l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,k(e);case 2:case"end":return n.stop()}}),n)}))),children:"Unsend message"})})]})})]}):"audio"===e.type?(0,t.jsxs)(P.k,{className:"justify-end relative",boxSize:(e.deleted,""),bg:(e.deleted,"black"),minW:e.deleted?"":"100px",maxW:e.deleted?"":"350px",my:"1",p:e.deleted?"3":"0",children:[e.deleted?(0,t.jsx)(gn.x,{children:(0,t.jsx)("i",{children:e.content})}):(0,t.jsx)(In(),{src:e.src,controls:!0}),e.deleted?null:(0,t.jsxs)(A.v2,{children:[(0,t.jsx)(A.j2,{as:O.h,"aria-label":"Options",icon:(0,t.jsx)(kn.v,{}),variant:"none",px:0,py:0,mx:0,my:0}),(0,t.jsx)(A.qy,{children:(0,t.jsx)(A.sN,{onClick:Mn(l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,k(e);case 2:case"end":return n.stop()}}),n)}))),children:"Unsend message"})})]})]}):null},n):(0,t.jsxs)(P.k,{className:"items-start",w:"100%",children:[(0,t.jsx)(N.qE,{size:"sm",name:a.username,className:"mr-2"}),"text"===e.type?(0,t.jsx)(P.k,{bg:"gray.100",color:"black",minW:"100px",maxW:"350px",my:"1",p:"3",children:(0,t.jsx)(gn.x,{children:e.deleted?(0,t.jsx)("i",{children:e.content}):e.content})}):"image"===e.type?(0,t.jsx)(P.k,{className:"justify-end relative",boxSize:e.deleted?"":"sm",bg:e.deleted?"black":"",minW:e.deleted?"":"100px",maxW:e.deleted?"":"350px",my:"1",p:e.deleted?"3":"0",children:e.deleted?(0,t.jsx)(gn.x,{children:(0,t.jsx)("i",{children:e.content})}):(0,t.jsx)(Cn.E,{src:e.src,alt:e.content})}):"audio"===e.type?(0,t.jsx)(P.k,{className:"justify-end relative",boxSize:(e.deleted,""),bg:(e.deleted,"black"),minW:e.deleted?"":"100px",maxW:e.deleted?"":"350px",my:"1",p:e.deleted?"3":"0",children:e.deleted?(0,t.jsx)(gn.x,{children:(0,t.jsx)("i",{children:e.content})}):(0,t.jsx)(In(),{src:e.src,controls:!0})}):null]},n)})):r&&"group"===r.type?r.messages.map((function(e,n){return"me"===e.from?(0,t.jsx)(P.k,{w:"100%",justify:"flex-end",children:"text"===e.type?(0,t.jsxs)(P.k,{bg:"black",color:"white",minW:"100px",maxW:"350px",my:"1",p:"3",className:"relative",children:[(0,t.jsx)(gn.x,{children:e.deleted?(0,t.jsx)("i",{children:e.content}):e.content}),e.deleted?null:(0,t.jsxs)(A.v2,{children:[(0,t.jsx)(A.j2,{as:O.h,"aria-label":"Options",icon:(0,t.jsx)(kn.v,{}),variant:"none",px:0,py:0,mx:0,my:0}),(0,t.jsx)(A.qy,{children:(0,t.jsx)(A.sN,{onClick:Mn(l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,k(e);case 2:case"end":return n.stop()}}),n)}))),children:"Unsend message"})})]})]}):"image"===e.type?(0,t.jsxs)(P.k,{className:"justify-end relative",boxSize:e.deleted?"":"sm",bg:e.deleted?"black":"",minW:e.deleted?"":"100px",maxW:e.deleted?"":"350px",my:"1",p:e.deleted?"3":"0",children:[e.deleted?(0,t.jsx)(gn.x,{children:(0,t.jsx)("i",{children:e.content})}):(0,t.jsx)(Cn.E,{src:e.src,alt:e.content}),e.deleted?null:(0,t.jsx)("div",{className:"absolute rounded border-black",children:(0,t.jsxs)(A.v2,{children:[(0,t.jsx)(A.j2,{as:O.h,"aria-label":"Options",icon:(0,t.jsx)(kn.v,{}),variant:"none",px:0,py:0,mx:0,my:0}),(0,t.jsx)(A.qy,{children:(0,t.jsx)(A.sN,{onClick:Mn(l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:k(e);case 1:case"end":return n.stop()}}),n)}))),children:"Unsend message"})})]})})]}):"audio"===e.type?(0,t.jsxs)(P.k,{className:"justify-end relative",boxSize:e.deleted?"":"sm",bg:e.deleted?"black":"red",minW:e.deleted?"":"100px",maxW:e.deleted?"":"350px",my:"1",p:e.deleted?"3":"0",children:[e.deleted?(0,t.jsx)(gn.x,{children:(0,t.jsx)("i",{children:e.content})}):(0,t.jsx)(In(),{src:e.src,controls:!0}),e.deleted?null:(0,t.jsxs)(A.v2,{children:[(0,t.jsx)(A.j2,{as:O.h,"aria-label":"Options",icon:(0,t.jsx)(kn.v,{}),variant:"none",px:0,py:0,mx:0,my:0}),(0,t.jsx)(A.qy,{children:(0,t.jsx)(A.sN,{onClick:Mn(l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:k(e);case 1:case"end":return n.stop()}}),n)}))),children:"Unsend message"})})]})]}):null},n):(0,t.jsxs)(P.k,{className:"items-start",w:"100%",children:[(0,t.jsx)(N.qE,{size:"sm",name:e.sender.username,className:"mr-2"}),"text"===e.type?(0,t.jsx)(P.k,{bg:"gray.100",color:"black",minW:"100px",maxW:"350px",my:"1",p:"3",children:(0,t.jsx)(gn.x,{children:e.deleted?(0,t.jsx)("i",{children:e.content}):e.content})}):"image"===e.type?(0,t.jsx)(P.k,{className:"justify-end relative",boxSize:e.deleted?"":"sm",bg:e.deleted?"black":"red",minW:e.deleted?"":"100px",maxW:e.deleted?"":"350px",my:"1",p:e.deleted?"3":"0",children:e.deleted?(0,t.jsx)(gn.x,{children:(0,t.jsx)("i",{children:e.content})}):(0,t.jsx)(Cn.E,{src:e.src,alt:e.content})}):"audio"===e.type?(0,t.jsx)(P.k,{className:"justify-end relative",boxSize:e.deleted?"":"sm",bg:e.deleted?"black":"red",minW:e.deleted?"":"100px",maxW:e.deleted?"":"350px",my:"1",p:e.deleted?"3":"0",children:e.deleted?(0,t.jsx)(gn.x,{children:(0,t.jsx)("i",{children:e.content})}):(0,t.jsx)(In(),{src:e.src,controls:!0})}):null]},n)})):null})})},Tn=r(5869),Hn=r(8488),Dn=r(3955),zn=r(427),Wn=r(2629);function Ln(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}var Gn=(0,d.oM)({name:"search",initialState:{query:null,profiles:null},reducers:{setSearchQuery:function(e,n){console.log("action payloa:",n.payload),e.query=n.payload},setProfiles:function(e,n){var r=[];console.log("profiles:",n.payload.profiles),null==n.payload.profiles?e.profiles=null:(n.payload.profiles.map((function(e){var t=function(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},t=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),t.forEach((function(n){Ln(e,n,r[n])}))}return e}({},e),o=n.payload.loggedInUser.user.friends.find((function(e){return e.uuid==t.uuid})),i=n.payload.loggedInUser.user.friendshipRequests.find((function(e){return e.uuid==t.uuid}));t.isAFriend=!!o,(null===i||void 0===i?void 0:i.reverse)?t.hasSentFriendshipRequestToProfile=!0:i&&(t.hasFriendshipRequestFromLoggedInProfile=!0),console.log("PROFILE OBJECT:",t),r.push(t)})),e.profiles=r)}}}),_n=(0,f.P1)((function(e){return e.entities.search}),(function(e){return e.query})),Bn=((0,f.P1)((function(e){return e.entities.search}),(function(e){return e.profiles})),Gn.actions),Jn=(Bn.setProfiles,Bn.setSearchQuery),$n=(Gn.reducer,r(4947));function Xn(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function Vn(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},t=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),t.forEach((function(n){Xn(e,n,r[n])}))}return e}var Zn=(0,d.oM)({name:"profiles",initialState:{list:[]},reducers:{addProfiles:function(e,n,r){var t=[];null==n.payload.profiles?e.list=null:(n.payload.profiles=n.payload.profiles.filter((function(e){return e.uuid!=n.payload.loggedInUser.user.profile.uuid})),n.payload.profiles.map((function(e){var r=Vn({},e),o=n.payload.loggedInUser.user.friends.find((function(e){return e.uuid==r.uuid})),i=n.payload.loggedInUser.user.friendshipRequests.find((function(e){return e.uuid==r.uuid}));r.isAFriend=!!o,(null===i||void 0===i?void 0:i.reverse)?r.hasFriendshipRequestFromLoggedInProfile=!0:i&&(r.hasSentFriendshipRequestToProfile=!0),console.log("PROFILE OBJECT:",r),t.push(r)})),e.list=t)},setFriendshipRequestSentOnProfile:function(e,n){e.list.find((function(e){return e.uuid==n.payload.profileUuid})).hasSentFriendshipRequestToProfile=!0},cancelFriendshipRequestSentOnProfile:function(e,n){e.list.find((function(e){return e.uuid==n.payload.profileUuid})).hasSentFriendshipRequestToProfile=!1},setHasFriendshipRequestFromLoggedInProfile:function(e,n){e.list.find((function(e){return e.uuid==n.payload.profileUuid})).hasFriendshipRequestFromLoggedInProfile=!0},unsetHasFriendshipRequestFromLoggedInProfile:function(e,n){e.list.find((function(e){return e.uuid==n.payload.profileUuid})).hasFriendshipRequestFromLoggedInProfile=!1},setFriendFlagOnProfile:function(e,n){var r;if(null!==e.list&&0!==(null===(r=e.list)||void 0===r?void 0:r.length)){var t=e.list.find((function(e){return e.uuid==n.payload.profileUuid}));t.isAFriend=!0,t.hasFriendshipRequestFromLoggedInProfile=!1,t.hasSentFriendshipRequestToProfile=!1}},unsetFriendFlagOnProfile:function(e,n){e.list.find((function(e){return e.uuid==n.payload.profileUuid})).isAFriend=!0},addProfile:function(e,n){var r=n.payload.profile;e.list=Vn({},e.list,Xn({},r.uuid,r))}}}),Kn=(0,f.P1)((function(e){return e.entities.profiles}),(function(e){return e.list})),Qn=Zn.actions,Yn=(Qn.addProfile,Qn.addProfiles),er=Qn.setFriendshipRequestSentOnProfile,nr=Qn.cancelFriendshipRequestSentOnProfile;Qn.setFriendFlagOnProfile,Qn.setHasFriendshipRequestFromLoggedInProfile,Qn.unsetHasFriendshipRequestFromLoggedInProfile,Zn.reducer;function rr(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function tr(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function or(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function a(e){tr(i,t,o,a,u,"next",e)}function u(e){tr(i,t,o,a,u,"throw",e)}a(void 0)}))}}function ir(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);a=!0);}catch(s){u=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return rr(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rr(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ar(e){var n=e.profile,r=(0,i.I0)(),o=(0,i.v9)(h),a=ir((0,c.r9)(),2)[1],u=ir((0,c.Gk)(),2)[1],s=ir((0,c.Gx)(),2)[1],d=(0,i.v9)(F),f=(0,Ge.useToast)();return(0,t.jsxs)(P.k,{className:"items-center w-full justify-between relative h-12 ",style:{flex:"1"},children:[(0,t.jsxs)(P.k,{className:"items-center ",children:[(0,t.jsx)(N.qE,{name:n.username,size:"sm",className:"mr-2"}),(0,t.jsx)("p",{className:"",children:n.username})]}),n.hasSentFriendshipRequestToProfile?(0,t.jsxs)(P.k,{className:"relative",children:[(0,t.jsx)(Be.z,{disabled:!0,className:"relative text-green-500 p-0",style:{borderRadius:"5px 0px 0px 5px"},children:"Friendship request sent"}),(0,t.jsx)(Be.z,{disabled:!1,className:"absolute bg-red-500 text-white",bg:"red",style:{borderRadius:"0px 5px 5px 0px"},onClick:or(l().mark((function e(){var t,i,a,s,c,f,v,p;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,u({profileUuid:n.uuid});case 3:i=e.sent,r(nr({profileUuid:n.uuid})),r(j({profileUuid:n.uuid,friendRequests:null===(t=o.user)||void 0===t?void 0:t.friendshipRequests})),i&&d.emit("cancel-friend-request",{content:(null===(a=o.user)||void 0===a||null===(s=a.profile)||void 0===s?void 0:s.username)+" cancelled the friend request.",from:null===(c=o.user)||void 0===c||null===(f=c.profile)||void 0===f?void 0:f.uuid,fromUsername:null===(v=o.user)||void 0===v||null===(p=v.profile)||void 0===p?void 0:p.username,to:n.uuid,toUsername:n.username});case 7:case"end":return e.stop()}}),e)}))),children:"Cancel"})]}):n.hasFriendshipRequestFromLoggedInProfile?(0,t.jsxs)(P.k,{className:"justify-end mt-3",children:[(0,t.jsx)(Be.z,{className:"mr-3 bg-green-500",variant:"ghost",onClick:or(l().mark((function e(){var t,i,u,s,c,v,p,m,y,h,g,x;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,a({profileUuid:n.uuid});case 3:c=e.sent,r(j({profileUuid:n.uuid,friendRequests:null===(t=o.user)||void 0===t?void 0:t.friendshipRequests})),r(w({friend:{uuid:n.uuid,username:n.username}})),r(X({conversation:null===(i=c.data)||void 0===i?void 0:i.acceptFriendRequest,loggedInProfileUuid:null===(u=o.user)||void 0===u||null===(s=u.profile)||void 0===s?void 0:s.uuid})),c&&d.emit("friendship-request-accepted",{content:(null===(v=o.user)||void 0===v||null===(p=v.profile)||void 0===p?void 0:p.username)+" accepted your friend request.",from:null===(m=o.user)||void 0===m||null===(y=m.profile)||void 0===y?void 0:y.uuid,fromUsername:null===(h=o.user)||void 0===h||null===(g=h.profile)||void 0===g?void 0:g.username,to:n.uuid,toUsername:n.username,conversation:null===(x=c.data)||void 0===x?void 0:x.acceptFriendRequest}),f.close(n.uuid);case 9:case"end":return e.stop()}}),e)}))),children:"Accept"}),(0,t.jsx)(Be.z,{className:"bg-red-500",variant:"tomato",children:"Reject"})]}):(0,t.jsx)(fe.xu,{children:n.isAFriend?(0,t.jsx)(P.k,{className:"w-full z-40 h-full cursor-pointer",children:(0,t.jsx)($n.k,{className:"mr-3 mt-1",onClick:function(){}})}):(0,t.jsx)(Be.z,{onClick:or(l().mark((function e(){var t,i,a,u,c,f;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r(er({profileUuid:n.uuid})),r(b({friendRequest:{uuid:n.uuid,username:n.username,reverse:!1}})),e.next=5,s({profileUuid:n.uuid});case 5:d.emit("send-friend-request",{content:(null===(t=o.user)||void 0===t||null===(i=t.profile)||void 0===i?void 0:i.username)+" wants to be your friend.",from:null===(a=o.user)||void 0===a||null===(u=a.profile)||void 0===u?void 0:u.uuid,fromUsername:null===(c=o.user)||void 0===c||null===(f=c.profile)||void 0===f?void 0:f.username,to:n.uuid,toUsername:n.username});case 6:case"end":return e.stop()}}),e)}))),children:"Send friend request"})})]},n.uuid)}function ur(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function sr(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);a=!0);}catch(s){u=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,n)||cr(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lr(e){return function(e){if(Array.isArray(e))return ur(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||cr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cr(e,n){if(e){if("string"===typeof e)return ur(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ur(e,n):void 0}}function dr(){var e=(0,i.I0)(),n=(0,i.v9)(h),r=(0,i.v9)(_n),a=(0,i.v9)(Kn),u=sr((0,c.Rh)({variables:{username:r}}),1)[0].data;return(0,o.useEffect)((function(){return(null===u||void 0===u?void 0:u.searchForProfileByUsername)&&n.user&&e(Yn({profiles:null===u||void 0===u?void 0:u.searchForProfileByUsername,loggedInUser:n})),function(){e(Yn({profiles:null,loggedInUser:n}))}}),[null===u||void 0===u?void 0:u.searchForProfileByUsername,n]),console.log("search results:",null===u||void 0===u?void 0:u.searchForProfileByUsername),(0,t.jsx)(P.k,{className:"w-full",children:a?lr(Object.values(a)).map((function(e,n){return e?(0,t.jsx)(ar,{profile:e},n):null})):null})}var fr=function(){var e=o.useRef(),n=(0,i.I0)(),r=(0,i.v9)(_n),a=(0,i.v9)(ge),u=(0,o.useState)(null),s=u[0],l=u[1];return(0,Tn.O)({ref:e,handler:function(){n(Jn(null)),l(null),n(we({searchActive:!1,containerDisplay:"relative",containerHeight:"5vh",inputPadding:"5px"})),n(Ue("87.5vh"))}}),(0,t.jsx)(P.k,{ref:e.current,className:"flex-col border-b px-3 w-full ",style:{position:a.containerDisplay,height:a.containerHeight,transition:"all .5s",marginTop:"+0.5px"},children:(0,t.jsxs)(P.k,{className:"px-3 justify-center h-full w-full",children:[(0,t.jsxs)(P.k,{className:"flex-col items-start justify-start",style:{flex:"0.7"},children:[a.searchActive?(0,t.jsx)("p",{className:"text-xl mt-4 mb-10",children:"Search Results"}):null,s&&a.searchActive?(0,t.jsx)(P.k,{className:"w-full",style:{flex:"1"},children:(0,t.jsx)(dr,{})}):null]}),(0,t.jsx)(P.k,{className:"items-center relative ",style:{flex:"0.3"},children:(0,t.jsxs)(Hn.B,{children:[(0,t.jsx)(Dn.x,{pointerEvents:"none"}),(0,t.jsx)(zn.W,{color:"gray.300"}),(0,t.jsx)(_e.I,{type:"text",className:"m-0 focus:bg-base-100 bg-transparent outline-0 bg-gray-800 pl-2",placeholder:"Search for profiles...",size:"md",onClick:function(){n(Ue("52.5vh")),n(we({searchActive:!0,containerDisplay:"relative",containerHeight:"40vh",inputPadding:"10px"}))},style:{padding:a.inputPadding,transition:"all .5s",position:a.containerDisplay,right:0},onKeyPress:function(e){"Enter"===e.key&&e.target.value!==r&&(n(Jn(null)),l(null),n(Jn(e.target.value)),l(e.target.value))}})]})}),a.searchActive?(0,t.jsx)(Wn.H,{className:"bg-black p-1 absolute top-0 right-0 m-4 text-2xl cursor-pointer",onClick:function(){n(Jn(null)),l(null),n(we({searchActive:!1,containerDisplay:"relative",containerHeight:"5vh",inputPadding:"5px"})),n(Ue("87.5vh"))}}):null]})})},vr=r(5162),pr=r(7632);function mr(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function yr(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}var hr=function(e){var n=e.children,r=(0,i.I0)(),a=(0,i.v9)(h),u=(0,i.v9)(_),s=(0,i.v9)(G),c=(0,i.v9)(F),d=(0,vr.uI)(),f=d.acceptedFiles,v=d.getRootProps;return(0,o.useEffect)((function(){if(0!==f.length){var e,n,t=f[0],o=new(rn());o.append("file",t,"file"),o.append("conversationUuid",u.uuid),o.append("messageUuid",(0,pr.Z)()),o.append("senderUuid",null===(e=a.user)||void 0===e||null===(n=e.profile)||void 0===n?void 0:n.uuid),on().post("http://localhost:4020/media_api/upload_image",o,{headers:{accept:"application/json","Accept-Language":"en-US,en;q=0.8","Content-Type":"multipart/form-data; boundary=".concat(o._boundary)}}).then(function(){var e,n=(e=l().mark((function e(n){var t,o,i,d,f,v,p,m,y,h;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"pm"===u.type?c.emit("private-chat-message",{content:(null===(f=a.user)||void 0===f||null===(v=f.profile)||void 0===v?void 0:v.username)+" sent you a message.",from:null===(p=a.user)||void 0===p||null===(m=p.profile)||void 0===m?void 0:m.uuid,fromUsername:null===(y=a.user)||void 0===y||null===(h=y.profile)||void 0===h?void 0:h.username,to:s.uuid,toUsername:s.username,messageUuid:n.data.uuid,message:n.data.content,type:n.data.type,src:n.data.src,conversationUuid:u.uuid}):u.profiles.map((function(e){var r,t,o,i,s,l,d,f;e.uuid!==(null===(r=a.user)||void 0===r||null===(t=r.profile)||void 0===t?void 0:t.uuid)&&c.emit("private-chat-message",{content:(null===(o=a.user)||void 0===o||null===(i=o.profile)||void 0===i?void 0:i.username)+" sent you a message.",from:null===(s=a.user)||void 0===s||null===(l=s.profile)||void 0===l?void 0:l.uuid,fromUsername:null===(d=a.user)||void 0===d||null===(f=d.profile)||void 0===f?void 0:f.username,to:e.uuid,toUsername:e.username,messageUuid:n.data.uuid,message:n.data.content,type:n.data.type,src:n.data.src,conversationUuid:u.uuid})})),r(Y({uuid:n.data.uuid,message:n.data.content,from:"me",type:n.data.type,src:n.data.src,conversationUuid:u.uuid,deleted:!1,sender:{uuid:null===a||void 0===a||null===(t=a.user)||void 0===t||null===(o=t.profile)||void 0===o?void 0:o.uuid,username:null===a||void 0===a||null===(i=a.user)||void 0===i||null===(d=i.profile)||void 0===d?void 0:d.username}}));case 3:case"end":return e.stop()}}),e)})),function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function a(e){mr(i,t,o,a,u,"next",e)}function u(e){mr(i,t,o,a,u,"throw",e)}a(void 0)}))});return function(e){return n.apply(this,arguments)}}()).catch((function(e){console.log("error:",e)}))}}),[f]),(0,t.jsx)("div",function(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},t=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),t.forEach((function(n){yr(e,n,r[n])}))}return e}({},v({className:"dropzone"}),{children:n}))},gr=r(2175);function xr(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function br(e){return function(e){if(Array.isArray(e))return xr(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"===typeof e)return xr(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xr(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var jr=0,wr=(0,d.oM)({name:"groups",initialState:{groups:null,groupBeingCreated:null,participants:[]},reducers:{createGroup:function(e,n){e.push({id:++jr,name:n.payload.name})},clearState:function(e,n){e.participants=[],e.groupBeingCreated=null},addParticipants:function(e,n){e.participants.push(n.payload)},removeParticipants:function(e,n){var r=br(e.participants);r.splice(r.indexOf(n.payload),1),e.participants=r}}}),Ur=((0,f.P1)((function(e){return e.entities.groups}),(function(e){return e.groups})),(0,f.P1)((function(e){return e.entities.groups}),(function(e){return e.participants}))),Sr=wr.actions,Cr=(Sr.createGroup,Sr.addParticipants),kr=Sr.removeParticipants,Pr=Sr.clearState,Ir=(wr.reducer,function(e){var n=e.participant,r=(0,i.I0)(),a=(0,o.useState)(""),u=a[0],s=a[1];return(0,t.jsx)(P.k,{className:"p-2 cursor:pointer hover:text-black text-white cursor-pointer",style:{backgroundColor:u},onClick:function(){""===u?(s("green"),r(Cr(n.uuid))):(s(""),r(kr(n.uuid)))},children:n.username})});function Ar(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function Or(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function Nr(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function Mr(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},t=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),t.forEach((function(n){Nr(e,n,r[n])}))}return e}function Fr(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);a=!0);}catch(s){u=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,n)||Er(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qr(e){return function(e){if(Array.isArray(e))return Ar(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Er(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Er(e,n){if(e){if("string"===typeof e)return Ar(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ar(e,n):void 0}}var Rr=function(e){e=null!==e?e:function(e){throw e}(new TypeError("Cannot destructure undefined"));var n=(0,i.I0)(),r=(0,i.v9)(F),a=(0,i.v9)(Ur),u=(0,i.v9)(h),s=(0,o.useState)(null),d=s[0],f=s[1],v=Fr((0,c.yW)(),2)[1];(0,o.useEffect)((function(){var e;return f(null===u||void 0===u||null===(e=u.user)||void 0===e?void 0:e.friends),r&&r.on("set-ongoing-call-for-conversation",(function(e){var r=e.from,t=e.fromUsername;n(te({uuid:"",initiator:{uuid:r,username:t}}))})),function(){r&&r.off("set-ongoing-call-for-conversation")}}),[]);var p=(0,gr.TA)({initialValues:{name:"",description:""},onSubmit:function(){var e,t=(e=l().mark((function e(t){var o,i,s,c,d,f,p,m,y,h,g,x,b;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===a.length){e.next=12;break}return(x=qr(a)).push(null===(o=u.user)||void 0===o||null===(i=o.profile)||void 0===i?void 0:i.uuid),e.next=6,v({input:Mr({},t,{type:"group"}),participants:x});case 6:b=e.sent,n(Pr(null)),r.emit("group-created",{fromUuid:null===(s=u.user)||void 0===s||null===(c=s.profile)||void 0===c?void 0:c.uuid,fromUsername:null===(d=u.user)||void 0===d||null===(f=d.profile)||void 0===f?void 0:f.username,groupUuid:null===(p=b.data)||void 0===p?void 0:p.createGroupConversation.uuid,conversation:null===(m=b.data)||void 0===m?void 0:m.createGroupConversation,participants:x}),console.log("conversation:",b),n(X({conversation:null===(y=b.data)||void 0===y?void 0:y.createGroupConversation,loggedInProfileUuid:null===(h=u.user)||void 0===h||null===(g=h.profile)||void 0===g?void 0:g.uuid})),n(je(!1));case 12:case"end":return e.stop()}}),e)})),function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function a(e){Or(i,t,o,a,u,"next",e)}function u(e){Or(i,t,o,a,u,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}()});return(0,t.jsxs)(P.k,{className:"flex-col w-full py-3 px-5 relative box-content h-full",style:{height:"70vh"},children:[(0,t.jsxs)(P.k,{className:"w-full justify-between",children:[(0,t.jsx)("p",{className:"mb-5",children:"Create Group"}),(0,t.jsx)(Be.z,{className:"mr-8",onClick:function(){n(je(!1))},children:"X"})]}),(0,t.jsxs)(P.k,{children:[(0,t.jsx)("form",{className:"flex w-2/4",onSubmit:p.handleSubmit,children:(0,t.jsxs)(P.k,{className:"mr-5",direction:"column",children:[(0,t.jsxs)(fe.xu,{children:[(0,t.jsx)("label",{children:"Group name"}),(0,t.jsx)(_e.I,{name:"name",type:"text",label:"Group name",onChange:p.handleChange,value:p.values.name})]}),(0,t.jsxs)(fe.xu,{mt:4,children:[(0,t.jsx)("label",{children:"Group description"}),(0,t.jsx)(_e.I,{name:"description",type:"text",label:"Group description",onChange:p.handleChange,value:p.values.description})]}),(0,t.jsx)(Be.z,{mt:4,type:"submit",colorScheme:"teal",className:"box-content",children:"create group"})]})}),(0,t.jsxs)(P.k,{className:"flex-col text-black w-2/4 box-content",children:[(0,t.jsx)("p",{className:"text-white",children:"Add friends"}),d?d.map((function(e){return(0,t.jsx)(Ir,{participant:e},e.uuid)})):null]})]})]})};function Tr(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function Hr(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function Dr(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);a=!0);}catch(s){u=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,n)||Wr(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zr(e){return function(e){if(Array.isArray(e))return Tr(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Wr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wr(e,n){if(e){if("string"===typeof e)return Tr(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Tr(e,n):void 0}}var Lr=(0,r(5152).default)((function(){return r.e(41).then(r.bind(r,5041)).then((function(e){return e.JitsiMeeting}))}),{loadableGenerated:{webpack:function(){return[5041]}},ssr:!1}),Gr=function(e){var n,r=e.conversationUuid,a=e.profile,u=e.email,s=(0,i.I0)(),d=(0,i.v9)(h),f=(0,i.v9)(_),v=(0,o.useRef)(),p=(0,o.useState)([]),m=p[0],y=p[1],g=(0,o.useState)(!1)[0],x=(0,o.useState)([]),b=x[0],j=x[1],w=Dr((0,c.Fg)(),2)[1],U=function(e){y((function(n){return zr(n).concat([JSON.stringify(e)])}))},S=function(e,n){e.muted?y((function(e){return zr(e).concat(["".concat(n," off")])})):y((function(e){return zr(e).concat(["".concat(n," on")])}))},C=function(){var e,n=(e=l().mark((function e(){var n,r,t,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(ke(!1)),s(ie({conversationUuid:f.uuid,loggedInProfileUuid:null===(n=d.user)||void 0===n||null===(r=n.profile)||void 0===r?void 0:r.uuid})),e.next=5,w({conversationUuid:f.uuid,profileUuid:null===(t=d.user)||void 0===t||null===(o=t.profile)||void 0===o?void 0:o.uuid});case 5:case"end":return e.stop()}}),e)})),function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function a(e){Hr(i,t,o,a,u,"next",e)}function u(e){Hr(i,t,o,a,u,"throw",e)}a(void 0)}))});return function(){return n.apply(this,arguments)}}(),k=function(e){!e.isOpen&&e.unreadCount&&(v.current&&v.current.executeCommand("toggleChat"),y((function(n){return zr(n).concat(["you have ".concat(e.unreadCount," unread messages")])})))},I=function(e){y((function(n){return zr(n).concat([JSON.stringify(e)])})),j((function(n){return zr(n).concat([null===e||void 0===e?void 0:e.participant])}))};n="3",b.forEach((function(e){var r;v.current.executeCommand("answerKnockingParticipant",null===(r=e)||void 0===r?void 0:r.id,n(e)),j((function(n){return n.filter((function(n){return n.id===e.id}))}))}));var A,O=function(e){e.style.background="#3d3d3d",e.style.height="900px"};A={ddd:"ded"},v.current=A(null===v||void 0===v?void 0:v.current).on("knockingParticipant",I)(null===v||void 0===v?void 0:v.current).on("audioMuteStatusChanged",(function(e){return S(e,"audio")}))(null===v||void 0===v?void 0:v.current).on("videoMuteStatusChanged",(function(e){return S(e,"video")}))(null===v||void 0===v?void 0:v.current).on("raiseHandUpdated",U)(null===v||void 0===v?void 0:v.current).on("titleViewChanged",U)(null===v||void 0===v?void 0:v.current).on("chatUpdated",k)(null===v||void 0===v?void 0:v.current).on("knockingParticipant",I);alert("Ready to close...");"JitsiMeetRoomNo".concat(100*Math.random(),"-").concat(Date.now());var N=function(){return(0,t.jsx)("div",{style:{fontFamily:"sans-serif",textAlign:"center"},children:"Loading..."})};return(0,t.jsxs)(P.k,{flexDirection:"column-reverse",className:"w-full top-0 py-3 px-5 relative",style:{height:"80vh"},children:[(0,t.jsx)(Lr,{domain:"noon-vid.com/",roomName:r,onReadyToClose:C,spinner:N,userInfo:{displayName:a.username,email:u},interfaceConfigOverwrite:{},configOverwrite:{startWithAudioMuted:!0,disableModeratorIndicator:!0,startScreenSharing:!1,enableEmailInStats:!1},getIFrameRef:O}),g?(0,t.jsx)(Lr,{domain:"noon-vid.com/",roomName:r,onReadyToClose:C,spinner:N,configOverwrite:{startWithAudioMuted:!0,disableModeratorIndicator:!0,startScreenSharing:!1,enableEmailInStats:!1},getIFrameRef:O}):null,m.map((function(e,n){return(0,t.jsx)("div",{style:{fontFamily:"monospace",padding:"5px"},children:e},n)}))]})};function _r(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function Br(e,n,r,t,o,i,a){try{var u=e[i](a),s=u.value}catch(l){return void r(l)}u.done?n(s):Promise.resolve(s).then(t,o)}function Jr(e){return function(){var n=this,r=arguments;return new Promise((function(t,o){var i=e.apply(n,r);function a(e){Br(i,t,o,a,u,"next",e)}function u(e){Br(i,t,o,a,u,"throw",e)}a(void 0)}))}}function $r(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);a=!0);}catch(s){u=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return _r(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _r(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Xr=function(){var e,n,r,a,u=(0,i.I0)(),s=(0,i.v9)(h),d=(0,i.v9)(he),f=(0,o.useState)(""),v=f[0],p=f[1],m=(0,i.v9)(F),y=(0,i.v9)(_),g=(0,i.v9)(B),x=(0,i.v9)(Ce),S=(0,i.v9)(xe),C=(0,i.v9)(G),k=$r((0,c.J_)(),2)[1],I=$r((0,c.g6)(),2)[1],A=$r((0,c.FG)(),2)[1],O=(0,Ge.useToast)();(0,o.useEffect)((function(){return m&&(m.on("message-deleted-confirmed",(function(){alert("delete message confirmed received")})),m.on("private-chat-message",(function(e){var n,r=e.from,t=e.fromUsername,o=e.messageUuid,i=e.message,a=e.conversationUuid,l=e.type,c=e.src;if(i.trim().length){var d,f,v=i;if(!1===g||a!==y.uuid)A({conversationUuid:a,profileUuid:null===s||void 0===s||null===(d=s.user)||void 0===d||null===(f=d.profile)||void 0===f?void 0:f.uuid});u(Y({uuid:o,message:v,sender:{uuid:r,username:t},from:"computer",conversationUuid:a,loggedInProfile:null===(n=s.user)||void 0===n?void 0:n.profile,type:l,src:c}))}}))),function(){m&&m.off("private-chat-message")}}),[m,g]),(0,o.useEffect)((function(){return m&&(m.on("friendship-request-accepted",(function(e){var n,r,t,o=e.from,i=e.fromUsername,a=e.conversation;u(j({profileUuid:o,friendRequests:null===(n=s.user)||void 0===n?void 0:n.friendshipRequests})),u(w({friend:{uuid:o,username:i}})),u(X({conversation:a,loggedInProfileUuid:null===(r=s.user)||void 0===r||null===(t=r.profile)||void 0===t?void 0:t.uuid}))})),m.on("cancel-friend-request",(function(e){var n,r=e.from,t=e.fromUsername;u(j({profileUuid:r,friendRequests:null===(n=s.user)||void 0===n?void 0:n.friendshipRequests})),O.close(r),O({id:r,title:"".concat(t," has cancelled the friend request."),position:"bottom-right",isClosable:!0,status:"error",duration:5e3})})),m.on("send-friend-request",(function(e){var n=e.from,r=e.fromUsername;u(b({friendRequest:{uuid:n,username:r,reverse:!0}}))})),m.on("unfriend",(function(e){var n,r=e.from,t=e.conversationUuid;u(U({profileUuid:r,friends:null===(n=s.user)||void 0===n?void 0:n.friends})),u(V({conversationUuid:t})),console.log("active conversation:",y),console.log("conversation uuid:",t),y&&y.uuid===t&&(u(re(!1)),u(K(null)),u(Q(null)),u(ue(!1)))})),m.on("invited-to-group",(function(e){var n,r,t=e.conversation;console.log("invited to group received:",t),u(X({conversation:t,loggedInProfileUuid:null===(n=s.user)||void 0===n||null===(r=n.profile)||void 0===r?void 0:r.uuid}))})),m.on("left-group",(function(e){var n=e.fromUuid,r=e.conversationUuid;u(le({conversationUuid:r,participantUuid:n}))})),m&&m.on("set-pending-call-for-conversation",(function(e){var n,r,t=e.conversationUuid,o=e.from;u(oe({profileUuid:null===(n=s.user)||void 0===n||null===(r=n.profile)||void 0===r?void 0:r.uuid,from:o,pendingCall:!0,ongoingCall:!1,conversationUuid:t}))}))),function(){m&&(m.off("send-friend-request"),m.off("cancel-friend-request"),m.off("friendship-request-accepted"),m.off("unfriend"),m.off("set-pending-call-for-conversation"))}}),[m]);var N=function(){var e=Jr(l().mark((function e(){var n,r,t,o,i,a,c,d;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.trim().length){e.next=3;break}return e.abrupt("return");case 3:return c=v,p(""),e.next=7,I({message:c,type:"text",src:"",conversationUuid:y.uuid});case 7:d=e.sent,y.profiles.map((function(e){var n,r,t,o,i,a,u,l,f,v;e.uuid!==(null===(n=s.user)||void 0===n||null===(r=n.profile)||void 0===r?void 0:r.uuid)&&m.emit("private-chat-message",{content:(null===(t=s.user)||void 0===t||null===(o=t.profile)||void 0===o?void 0:o.username)+" sent you a message.",from:null===(i=s.user)||void 0===i||null===(a=i.profile)||void 0===a?void 0:a.uuid,fromUsername:null===(u=s.user)||void 0===u||null===(l=u.profile)||void 0===l?void 0:l.username,to:e.uuid,toUsername:e.username,messageUuid:null===(f=d.data)||void 0===f||null===(v=f.saveGroupMessage)||void 0===v?void 0:v.uuid,message:c,type:"text",src:"",conversationUuid:y.uuid})})),u(Y({uuid:null===(n=d.data)||void 0===n||null===(r=n.saveGroupMessage)||void 0===r?void 0:r.uuid,message:c,sender:{uuid:null===s||void 0===s||null===(t=s.user)||void 0===t||null===(o=t.profile)||void 0===o?void 0:o.uuid,username:null===s||void 0===s||null===(i=s.user)||void 0===i||null===(a=i.profile)||void 0===a?void 0:a.username},from:"me",type:"text",src:"",conversationUuid:y.uuid}));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),M=function(){var e=Jr(l().mark((function e(){var n,r,t,o,i,a,c,d,f,h,g,x,b,j,w,U;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.trim().length){e.next=3;break}return e.abrupt("return");case 3:return w=v,p(""),e.next=7,k({message:w,type:"text",src:"",conversationUuid:y.uuid,to:C.uuid});case 7:U=e.sent,m.emit("private-chat-message",{content:(null===(n=s.user)||void 0===n||null===(r=n.profile)||void 0===r?void 0:r.username)+" sent you a message.",from:null===(t=s.user)||void 0===t||null===(o=t.profile)||void 0===o?void 0:o.uuid,fromUsername:null===(i=s.user)||void 0===i||null===(a=i.profile)||void 0===a?void 0:a.username,to:C.uuid,toUsername:C.username,messageUuid:null===(c=U.data)||void 0===c||null===(d=c.saveMessage)||void 0===d?void 0:d.uuid,message:w,type:"text",src:"",conversationUuid:y.uuid}),u(Y({uuid:null===(f=U.data)||void 0===f||null===(h=f.saveMessage)||void 0===h?void 0:h.uuid,message:w,sender:{uuid:null===s||void 0===s||null===(g=s.user)||void 0===g||null===(x=g.profile)||void 0===x?void 0:x.uuid,username:null===s||void 0===s||null===(b=s.user)||void 0===b||null===(j=b.profile)||void 0===j?void 0:j.username},from:"me",type:"text",src:"",conversationUuid:y.uuid}));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,t.jsxs)(P.k,{className:"flex-col bg-gray-700 text-white box-content relative",style:{flex:"0.75",height:"100vh",overflow:"hidden"},children:[(0,t.jsx)(fr,{}),d?(0,t.jsx)(P.k,{className:"flex-col p-0 box-content",style:{height:S,transition:"all .5s"},children:(0,t.jsx)(Rr,{})}):null,y&&"group"===y.type?(0,t.jsxs)(P.k,{className:"flex-col p-0 box-content",style:{height:S,transition:"all .5s"},children:[(0,t.jsx)(Un,{}),!0!==x?(0,t.jsx)(hr,{children:(0,t.jsx)(Rn,{})}):(0,t.jsx)(Gr,{conversationUuid:y.uuid,profile:null===(e=s.user)||void 0===e?void 0:e.profile,email:null===(n=s.user)||void 0===n?void 0:n.email})]}):null,C&&y&&"pm"===y.type?(0,t.jsxs)(P.k,{className:"flex-col p-0 box-content",style:{height:S,transition:"all .5s"},children:[(0,t.jsx)(Un,{}),!0!==x?(0,t.jsx)(hr,{children:(0,t.jsx)(Rn,{})}):(0,t.jsx)(Gr,{conversationUuid:y.uuid,profile:null===(r=s.user)||void 0===r?void 0:r.profile,email:null===(a=s.user)||void 0===a?void 0:a.email})]}):null,y?(0,t.jsx)(P.k,{w:"100%",flexDir:"column",className:"justify-center",style:{height:"7.5vh"},children:"pm"===y.type?(0,t.jsx)(hn,{inputMessage:v,setInputMessage:p,handleSendMessage:M}):(0,t.jsx)(hn,{inputMessage:v,setInputMessage:p,handleSendMessage:N})}):null]})};function Vr(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function Zr(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(t=r.next()).done)&&(i.push(t.value),!n||i.length!==n);a=!0);}catch(s){u=!0,o=s}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return Vr(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vr(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Kr=(0,a.X)(u.M,{ssr:!0})((function(){var e,n,r=(0,i.I0)(),a=Zr((0,c.UE)({pause:(0,Le.s)(),requestPolicy:"network-only"}),1)[0].data,u=(0,i.v9)(h),s=(0,i.v9)(W),l=Zr((0,c.Yq)(),1)[0].data;return(0,o.useEffect)((function(){r(x({user:a}))}),[null===a||void 0===a||null===(e=a.me)||void 0===e?void 0:e.username]),(0,o.useEffect)((function(){var e,n;(null===l||void 0===l?void 0:l.getConversationForLoggedInUser)&&null===s&&r(Z({conversationsToSend:null===l||void 0===l?void 0:l.getConversationForLoggedInUser,loggedInProfileUuid:null===u||void 0===u||null===(e=u.user)||void 0===e||null===(n=e.profile)||void 0===n?void 0:n.uuid}))}),[l]),(0,t.jsx)("div",{className:"flex",style:{overflow:"hidden"},children:(null===(n=u.user)||void 0===n?void 0:n.profile)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(We,{}),(0,t.jsx)(Xr,{})]}):null})}))}},function(e){e.O(0,[774,609,263,54,227,180,34,888,179],(function(){return n=5966,e(e.s=n);var n}));var n=e.O();_N_E=n}]);